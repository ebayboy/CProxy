2023/03/28 17: 10: 53 [debug
] 1296#1296: *7116 [lua
] radixtree.lua: 497: compare_param(): pcre pat: \/r*
2023/03/28 17: 10: 53 [info
] 1296#1296: *7116 [lua
] init.lua: 382: http_access_phase(): matched route: {
    "clean_handlers": {},
    "value": {
        "upstream": {
            "nodes_ref": [
                {
                    "weight": 2,
                    "host": "127.0.0.1",
                    "priority": 0,
                    "port": 9011
                },
                {
                    "weight": 1,
                    "host": "127.0.0.1",
                    "priority": 0,
                    "port": 9012
                }
            ],
            "hash_on": "vars",
            "type": "chash",
            "key": "remote_addr",
            "scheme": "http",
            "parent": {
                "clean_handlers": "table: 0x7ff70d40ca30",
                "value": "table: 0x7ff70da60498",
                "orig_modifiedIndex": 1679994135,
                "key": "\/routes\/arr_1",
                "modifiedIndex": 1679994135,
                "has_domain": false,
                "update_count": 0
            },
            "pass_host": "pass",
            "nodes": "table: 0x7ff7216f7810",
            "original_nodes": [
                {
                    "weight": 2,
                    "host": "127.0.0.1",
                    "port": 9011
                },
                {
                    "weight": 1,
                    "host": "127.0.0.1",
                    "port": 9012
                }
            ]
        },
        "uri": "\/r*",
        "status": 1,
        "id": "routes#1",
        "priority": 0,
        "hosts": [
            "*.r.com",
            "r.com",
            "r1.com"
        ],
        "plugins": {
            "jdt-zt": {
                "enable": true,
                "msg": "hellozt"
            }
        }
    },
    "orig_modifiedIndex": 1679994135,
    "key": "\/routes\/arr_1",
    "modifiedIndex": 1679994135,
    "has_domain": false,
    "update_count": 0
}, client: 10.226.143.198, server: _, request: "GET /rbc HTTP/1.1", host: "3.r.com"2023/03/28 17: 10: 53 [info
] 1296#1296: *7116 [lua
] balancer.lua: 194: pick_server(): route: {
    "clean_handlers": {},
    "value": {
        "upstream": {
            "nodes_ref": [
                {
                    "weight": 2,
                    "host": "127.0.0.1",
                    "priority": 0,
                    "port": 9011
                },
                {
                    "weight": 1,
                    "host": "127.0.0.1",
                    "priority": 0,
                    "port": 9012
                }
            ],
            "hash_on": "vars",
            "type": "chash",
            "key": "remote_addr",
            "scheme": "http",
            "parent": {
                "clean_handlers": "table: 0x7ff70d40ca30",
                "value": "table: 0x7ff70da60498",
                "orig_modifiedIndex": 1679994135,
                "key": "\/routes\/arr_1",
                "modifiedIndex": 1679994135,
                "has_domain": false,
                "update_count": 0
            },
            "pass_host": "pass",
            "nodes": "table: 0x7ff7216f7810",
            "original_nodes": [
                {
                    "weight": 2,
                    "host": "127.0.0.1",
                    "port": 9011
                },
                {
                    "weight": 1,
                    "host": "127.0.0.1",
                    "port": 9012
                }
            ]
        },
        "uri": "\/r*",
        "status": 1,
        "id": "routes#1",
        "priority": 0,
        "hosts": [
            "*.r.com",
            "r.com",
            "r1.com"
        ],
        "plugins": {
            "jdt-zt": {
                "enable": true,
                "msg": "hellozt"
            }
        }
    },
    "orig_modifiedIndex": 1679994135,
    "key": "\/routes\/arr_1",
    "modifiedIndex": 1679994135,
    "has_domain": false,
    "update_count": 0
}, client: 10.226.143.198, server: _, request: "GET /rbc HTTP/1.1", host: "3.r.com"2023/03/28 17: 10: 53 [info
] 1296#1296: *7116 [lua
] balancer.lua: 195: pick_server(): ctx: {
    "global_rules": "apisix.yaml key: global_rules",
    "plugins": "table: 0x7ff70dc170f8",
    "var": {
        "_ctx": {
            "global_rules": {
                "checker": "function: 0x7ff70da7e408",
                "sync_times": 0,
                "running": true,
                "values": [
                    {
                        "clean_handlers": {},
                        "modifiedIndex": 1679994135,
                        "value": {
                            "id": "1",
                            "plugins": {
                                "clickhouse-logger": {
                                    "max_retry_count": 0,
                                    "retry_delay": 1,
                                    "name": "clickhouse-logger",
                                    "endpoint_addr": "http:\/\/service-ck-294uelxm9j.ck-294uelxm9j-hb-public.jvessel2.jdcloud.com:8123",
                                    "ssl_verify": true,
                                    "password": "LogAnalyze@2023",
                                    "user": "nf1_zerotrust",
                                    "batch_max_size": 1000,
                                    "logtable": "alpha0",
                                    "buffer_duration": 60,
                                    "timeout": 3,
                                    "database": "nf1zt",
                                    "inactive_timeout": 5
                                }
                            }
                        },
                        "key": "\/global_rules\/1"
                    }
                ],
                "values_hash": {
                    "1": 1
                },
                "conf_version": 1679994135,
                "item_schema": {
                    "required": [
                        "plugins"
                    ],
                    "type": "object",
                    "properties": {
                        "id": {
                            "anyOf": [
                                {
                                    "pattern": "^[a-zA-Z0-9-_.]+$",
                                    "type": "string",
                                    "minLength": 1,
                                    "maxLength": 64
                                },
                                {
                                    "type": "integer",
                                    "minimum": 1
                                }
                            ]
                        },
                        "plugins": {
                            "type": "object"
                        },
                        "create_time": {
                            "type": "integer"
                        },
                        "update_time": "table: 0x7ff70dd70e80"
                    }
                },
                "key": "global_rules",
                "automatic": true
            },
            "plugins": {},
            "var": "table: 0x7ff721703de0",
            "matched_upstream": "table: 0x7ff70da61c60",
            "upstream_scheme": "http",
            "route_id": "routes#1",
            "upstream_key": "routes#1",
            "curr_req_matched": "table: 0x7ff70ccbca40",
            "conf_type": "route",
            "matched_route": "table: 0x7ff70cd5e458",
            "conf_version": 1679994135,
            "upstream_version": "1679994135#table: 0x7ff70da61c60",
            "upstream_conf": "table: 0x7ff70da61c60",
            "conf_id": "routes#1"
        },
        "_request": "cdata<void *>: 0x01790590",
        "_cache": {
            "request_method": "GET",
            "uri": "\/rbc",
            "host": "3.r.com",
            "upstream_scheme": "http",
            "request_uri": "\/rbc",
            "remote_addr": "10.226.143.198",
            "real_request_uri": "\/rbc"
        }
    },
    "matched_upstream": "table: 0x7ff70da61c60",
    "upstream_scheme": "http",
    "route_id": "routes#1",
    "upstream_key": "routes#1",
    "curr_req_matched": {
        "_host": "*.r.com",
        "_method": "GET",
        "_path": "\/r*"
    },
    "conf_type": "route",
    "matched_route": "table: 0x7ff70cd5e458",
    "conf_version": 1679994135,
    "upstream_version": "1679994135#table: 0x7ff70da61c60",
    "upstream_conf": {
        "nodes_ref": [
            {
                "weight": 2,
                "host": "127.0.0.1",
                "priority": 0,
                "port": 9011
            },
            {
                "weight": 1,
                "host": "127.0.0.1",
                "priority": 0,
                "port": 9012
            }
        ],
        "hash_on": "vars",
        "type": "chash",
        "key": "remote_addr",
        "scheme": "http",
        "parent": {
            "clean_handlers": {},
            "value": {
                "upstream": "table: 0x7ff70da61c60",
                "uri": "\/r*",
                "status": 1,
                "id": "routes#1",
                "priority": 0,
                "hosts": [
                    "*.r.com",
                    "r.com",
                    "r1.com"
                ],
                "plugins": {
                    "jdt-zt": {
                        "enable": true,
                        "msg": "hellozt"
                    }
                }
            },
            "orig_modifiedIndex": 1679994135,
            "key": "\/routes\/arr_1",
            "modifiedIndex": 1679994135,
            "has_domain": false,
            "update_count": 0
        },
        "pass_host": "pass",
        "nodes": "table: 0x7ff7216f7810",
        "original_nodes": [
            {
                "weight": 2,
                "host": "127.0.0.1",
                "port": 9011
            },
            {
                "weight": 1,
                "host": "127.0.0.1",
                "port": 9012
            }
        ]
    },
    "conf_id": "routes#1"
}, client: 10.226.143.198, server: _, request: "GET /rbc HTTP/1.1", host: "3.r.com"2023/03/28 17: 10: 53 [info
] 1296#1296: *7116 [lua
] chash.lua: 61: fetch_chash_hash_key(): upstream key: remote_addr, client: 10.226.143.198, server: _, request: "GET /rbc HTTP/1.1", host: "3.r.com"2023/03/28 17: 10: 53 [info
] 1296#1296: *7116 [lua
] chash.lua: 62: fetch_chash_hash_key(): hash_on: vars, client: 10.226.143.198, server: _, request: "GET /rbc HTTP/1.1", host: "3.r.com"2023/03/28 17: 10: 53 [info
] 1296#1296: *7116 [lua
] chash.lua: 63: fetch_chash_hash_key(): chash_key: "10.226.143.198", client: 10.226.143.198, server: _, request: "GET /rbc HTTP/1.1", host: "3.r.com"2023/03/28 17: 10: 53 [info
] 1296#1296: *7116 [lua
] init.lua: 560: http_access_phase(): stash ngx ctx: 1, client: 10.226.143.198, server: _, request: "GET /rbc HTTP/1.1", host: "3.r.com"2023/03/28 17: 10: 53 [info
] 1296#1296: *7116 [lua
] balancer.lua: 378: run(): proxy request to 127.0.0.1: 9011 while connecting to upstream, client: 10.226.143.198, server: _, request: "GET /rbc HTTP/1.1", host: "3.r.com"2023/03/28 17: 10: 53 [info
] 1296#1296: *7116 [lua
] init.lua: 576: fetch_ctx(): fetch ngx ctx: 1 while reading response header from upstream, client: 10.226.143.198, server: _, request: "GET /rbc HTTP/1.1", upstream: "http://127.0.0.1:9011/rbc", host: "3.r.com"2023/03/28 17: 10: 53 [info
] 1296#1296: *7116 [lua
] clickhouse-logger.lua: 139: phase_func(): metadata: {
    "clean_handlers": {},
    "modifiedIndex": 1679994135,
    "value": {
        "id": "clickhouse-logger",
        "log_format": {
            "time_iso8601": "$time_iso8601",
            "client_ip": "$remote_addr",
            "http_user_agent": "$http_user_agent",
            "zt_u_name": "$zt_u_name",
            "zt_cli_host": "$zt_cli_host",
            "zt_reason": "$zt_reason",
            "status": "$status",
            "req_id": "$request_id",
            "zt_u_id": "$zt_u_id",
            "uri": "$uri",
            "scheme": "$scheme",
            "zt_cli_osver": "$zt_cli_osver",
            "upstream_status": "$upstream_status",
            "zt_status": "$zt_status",
            "request_method": "$request_method",
            "host": "$host"
        }
    },
    "key": "\/plugin_metadata\/clickhouse-logger"
} while logging request, client: 10.226.143.198, server: _, request: "GET /rbc HTTP/1.1", upstream: "http://127.0.0.1:9011/rbc", host: "3.r.com"